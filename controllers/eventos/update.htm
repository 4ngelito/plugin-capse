<?php if (!$this->fatalError): ?>

    <div class="layout fancy-layout">
        <?= Form::open([
            'class' => 'layout',
            'data-change-monitor' => 'true',
            'data-window-close-confirm' => e(trans('anguro.capse::lang.evento.close_confirm')),
            'id' => 'evento-form'
        ]) ?>
            <?= $this->formRender() ?>

        <?= Form::close() ?>
    </div>
    <div class="layout-row">
        <button type="button" class="btn btn-default toggleMap pull-right">Ocultar Mapa</button>
    
        <div id="mapaWrapper">
            <div id="map"></div>        
        </div>
    </div>
    <script>
    $(document).ready(function() {
      //function initMap() {
        var myLatLng = {lat: -33.451190, lng: -70.654388};

        // Create a map object and specify the DOM element for display.
        var map = new google.maps.Map(document.getElementById('map'), {
          center: myLatLng,
          scrollwheel: false,
          zoom: 10
        });

        <?php 
        $n = 0;
        foreach($geocodes as $g){
            echo "var marker{$n} = new google.maps.Marker({ 
              map: map, 
              position: { lat: {$g['geocode']['location']['lat']},  lng: {$g['geocode']['location']['lng']} }, 
              title: '{$g['titulo']}' 
            }); 
      ";
            $n++;
        }
        ?>
      }
      );

    </script>

<?php else: ?>

    <div class="control-breadcrumb">
        <?= Block::placeholder('breadcrumb') ?>
    </div>
    <div class="padded-container">
        <p class="flash-message static error"><?= e(trans($this->fatalError)) ?></p>
        <p><a href="<?= Backend::url('anguro/capse/eventos') ?>" class="btn btn-default"><?= e(trans('anguro.capse::lang.evento.return_to_eventos')) ?></a></p>
    </div>

<?php endif ?>
